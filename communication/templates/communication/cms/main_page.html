{% extends 'base.html' %}
{% load static %}

{% block title %}Announcements{% endblock %}

{% block content %}
<div class="content-header">
  <div class="row"> 
    <div class="col-6 text-left" style="margin-bottom: 20px;">
      <h4>Announcement</h4>
    </div>
    <div class="col-6 text-right" style="margin-bottom: 20px;">
        {% if request.user.is_superuser %}
            <button onclick="window.location.href='{% url 'create_comm' id %}'" class="waves-effect waves-light btn bg-gradient-info">
                <i class="fa fa-plus" aria-hidden="true"></i> Add
            </button>
        {% else %}
            <button onclick="window.location.href='{% url 'create_comm' request.user.id %}'" class="waves-effect waves-light btn bg-gradient-info">
                <i class="fa fa-plus" aria-hidden="true"></i> Add
            </button>
        {% endif %}
    </div>
  </div>
</div>
             
<section class="content">
  <div class="row">
    <div class="col-12">
      <div class="box">
        <div class="box-body">
          <div class="table-responsive">
            <table id="example1" class="table table-hover">
              <thead>
                <tr>
                  <th>Sr.No.</th>
                  <th>Title</th>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Content</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                {% for communication in communications %}
                <tr id="communication-row-{{ communication.pk }}">
                    <td>{{ forloop.counter }}</td>
                    <td>{{ communication.title }}</td>
                    <td>{{ communication.date }}</td>
                    <td>{{ communication.time }}</td>
                    <td>{{ communication.description }}</td>
                    <td style="display: flex;">
                    <button onclick="window.location.href='{% url 'edit_comm' pk=communication.pk id=id %}'" class="waves-effect waves-light btn mr-2 bg-gradient-primary"><i class="fa fa-edit"></i></button>
                    <button onclick="deleteComm({{ communication.pk }}, {{ id }})" class="waves-effect waves-light btn bg-gradient-danger"><i class="fa fa-trash"></i></button>   
                    </td>
                  </tr>
                  {% endfor %}
              </tbody>            
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<script>
    function deleteComm(pk, id) {
        if (confirm('Are you sure you want to delete this announcement?')) {
            // Perform an AJAX request to delete the announcement
            fetch(`{% url 'delete_comm' pk=0 id=0 %}`.replace('0', pk).replace('0', id), {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                },
            }).then(response => {
                if (response.ok) {
                    document.getElementById(`communication-row-${pk}`).remove();
                } else {
                    alert('Failed to delete the announcement.');
                }
            }).catch(error => {
                console.error('Error:', error);
                alert('An error occurred while trying to delete the announcement.');
            });
        }
    }

    function filterTable() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const tableRows = document.getElementById('tableBody').getElementsByTagName('tr');

        for (let i = 0; i < tableRows.length; i++) {
            const rowData = tableRows[i].textContent.toLowerCase();
            if (rowData.includes(searchInput)) {
                tableRows[i].style.display = '';
            } else {
                tableRows[i].style.display = 'none';
            }
        }
    }
</script>
{% endblock %}
