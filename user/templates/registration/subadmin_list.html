{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="content-header">
    <div class="row">
        <div class="col-8 text-left">
            <h2 class="page-title">Committee List</h2>
          
        </div>
        {% if request.user.is_superuser %}
        <div class="col-4 text-right">
            <button onclick="window.location.href='{% url 'id_add_subadmin' request.resolver_match.kwargs.id %}'" class="waves-effect waves-light btn bg-gradient-info"><i class="fa fa-plus" aria-hidden="true"></i> Add</button>
        </div>
        {% else %}
        <div class="col-4 text-right">
            <button onclick="window.location.href='{% url 'id_add_subadmin' request.user.id %}'" class="waves-effect waves-light btn bg-gradient-info"><i class="fa fa-plus" aria-hidden="true"></i> Add</button>
        {% endif %}
        </div>
    </div>
</div>


<section class="content">
  <div class="row">
    <div class="col-12">
      <div class="box">
        <div class="box-body">
          <div class="table-responsive">
            <table id="example1" class="table  table-hover">
              <thead>
                <tr>
                    <th>Sr.No</th>
                    <th width="15%">Name</th>
                    <th width="20%">Role</th>
                    <th width="20%">Email</th>
                    <th width="20%">Phone Number</th>
                    <th width="20%">Flat Number</th>
                    <th width="10%">Actions</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                {% for subadmin in subadmins %}
                <tr id="subadmin-row-{{ subadmin.id }}">
                    <td>{{ forloop.counter }}</td>
                    <td>{{ subadmin.user.fullname }}</td>
                    <td>{{ subadmin.role }}</td>
                    <td>{{ subadmin.user.email }}</td>
                    <td>{{ subadmin.user.phone_number }}</td>
                    <td>{{ subadmin.flat_number }}</td>
                    <td style="display: flex;">
                        <a href="{% url 'edit_subadmin' subadmin.pk %}" class="waves-effect waves-light btn mr-2 bg-gradient-primary"><i class="fa fa-edit"></i></a>
                        <button  onclick="deleteSociety({{ subadmin.id }})" class="waves-effect waves-light btn bg-gradient-danger">
                            <i class="fa fa-trash"></i>
                        </button>
                        
                    </td>
                  </tr>
                  {% endfor %}
              </tbody>

             
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

    
    <!-- JavaScript for handling edit action, delete action, and search functionality -->
    <script>
        function deleteSubadmin(subadminId) {
            if (confirm("Are you sure you want to delete this subadmin?")) {
                fetch(/user/delete_subadmin/${subadminId}/, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/json',
                    }
                }).then(response => {
                    if (response.ok) {
                        document.getElementById(subadmin-row-${subadminId}).remove();
                    }
                });
            }
        }

        function filterTable() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const tableRows = document.getElementById('tableBody').getElementsByTagName('tr');

            for (let i = 0; i < tableRows.length; i++) {
                const rowData = tableRows[i].textContent.toLowerCase();
                if (rowData.includes(searchInput)) {
                    tableRows[i].style.display = '';
                } else {
                    tableRows[i].style.display = 'none';
                }
            }
        }
    </script>
</body>
</html>
{% endblock %}